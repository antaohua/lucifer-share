<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.muniu.cloud.lucifer.share.service.mapper.ConceptStockMapper">
    
    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.muniu.cloud.lucifer.share.service.entity.BoardStock">
        <id column="id" property="id" />
        <result column="board_code" property="boardCode" />
        <result column="stock_code" property="stockCode" />
        <result column="is_valid" property="isValid" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
    </resultMap>
    
    <!-- 批量插入概念板块成份股关系 -->
    <insert id="batchInsert" parameterType="java.util.List">
        INSERT INTO share_board_stock
            (board_code, stock_code, is_valid, create_time, update_time)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.boardCode}, #{item.stockCode}, #{item.isValid}, #{item.createTime}, #{item.updateTime})
        </foreach>
        ON DUPLICATE KEY UPDATE
            is_valid = VALUES(is_valid),
            update_time = VALUES(update_time)
    </insert>
    
    <!-- 获取指定概念板块的有效成份股 -->
    <select id="getValidStockCodes" resultType="java.lang.String">
        SELECT stock_code
        FROM share_board_stock
        WHERE board_code = #{boardCode}
        AND is_valid = 1
    </select>
    
    <!-- 批量更新成份股状态为无效 -->
    <update id="batchInvalidate">
        UPDATE share_board_stock
        SET 
            is_valid = 0,
            update_time = #{updateTime}
        WHERE board_code = #{boardCode}
        AND stock_code IN
        <foreach collection="stockCodes" item="stockCode" open="(" separator="," close=")">
            #{stockCode}
        </foreach>
    </update>
    
</mapper> 